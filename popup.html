<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dayflow</title>
<!--
  FONTS NOTE: Google Fonts cannot be loaded in MV3 extensions due to CSP restrictions.
  The stylesheet below uses a system font stack that closely matches DM Sans / DM Serif Display.
  If you want the exact fonts, download the WOFF2 files from fonts.google.com,
  place them in a /fonts/ folder, and add @font-face rules pointing to those local files.
  DM Sans:         https://fonts.google.com/specimen/DM+Sans
  DM Serif Display: https://fonts.google.com/specimen/DM+Serif+Display
-->
<style>
  :root {
    /* Font stacks that approximate DM Sans + DM Serif Display */
    --font-sans:   'DM Sans', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', sans-serif;
    --font-serif:  'DM Serif Display', 'Georgia', 'Times New Roman', serif;

    --bg:        #f7f3f0;
    --surface:   #ffffff;
    --lavender:  #c9b8f0;
    --lavender-l:#ede8fc;
    --peach:     #f5c4a8;
    --peach-l:   #fef0e8;
    --mint:      #a8ddd0;
    --mint-l:    #e4f6f2;
    --border:    rgba(180,160,220,0.15);
    --text:      #4a4560;
    --text-mid:  #8b84a8;
    --text-dim:  #b8b2cc;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    width: 370px;
    background: var(--bg);
    font-family: var(--font-sans);
    color: var(--text);
    overflow: hidden;
  }

  .bg-mesh {
    position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
      radial-gradient(ellipse 180% 120% at 90% 0%,   rgba(201,184,240,0.22) 0%, transparent 55%),
      radial-gradient(ellipse 140% 100% at -10% 100%, rgba(168,221,208,0.18) 0%, transparent 55%),
      radial-gradient(ellipse 120% 80%  at 50% 50%,   rgba(245,196,168,0.10) 0%, transparent 60%);
  }

  .popup { position: relative; z-index: 1; }

  /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
  #loadingState {
    height: 280px; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 12px;
  }
  .loading-orb {
    width: 36px; height: 36px; border-radius: 50%;
    border: 2px solid var(--lavender-l);
    border-top-color: var(--lavender);
    animation: spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 12px; color: var(--text-dim); font-style: italic; }

  /* ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ */
  #errorState {
    display: none; height: 280px; flex-direction: column;
    align-items: center; justify-content: center; gap: 14px;
    padding: 24px;
  }
  .error-icon { font-size: 32px; }
  #errorMsg { font-size: 13px; color: var(--text-mid); text-align: center; line-height: 1.5; }
  #signInBtn {
    background: white; border: 1.5px solid rgba(201,184,240,0.5);
    color: #8b6fcc; font-family: var(--font-sans);
    font-size: 12px; font-weight: 500; padding: 9px 20px;
    border-radius: 10px; cursor: pointer;
    transition: all 0.2s; box-shadow: 0 2px 10px rgba(201,184,240,0.18);
  }
  #signInBtn:hover { background: var(--lavender-l); border-color: var(--lavender); }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header {
    padding: 16px 18px 14px;
    border-bottom: 1px solid var(--border);
  }
  .header-top {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 8px;
  }
  .wordmark {
    font-family: var(--font-serif);
    font-size: 19px; letter-spacing: 0.3px; color: var(--text);
  }
  .wordmark em {
    font-style: italic;
    background: linear-gradient(135deg, #c9b8f0, #f0b8c8);
    -webkit-background-clip: text; background-clip: text; color: transparent;
  }
  .streak-pill {
    display: inline-flex; align-items: center; gap: 4px;
    background: var(--peach-l); border: 1px solid rgba(245,196,168,0.5);
    border-radius: 20px; padding: 3px 10px;
    font-size: 10px; color: #c47b5a; font-weight: 500;
  }
  .header-meta { display: flex; align-items: center; justify-content: space-between; }
  .date-label { font-size: 11px; font-weight: 300; color: var(--text-mid); }

  /* ‚îÄ‚îÄ TODAY'S JOURNEY ‚îÄ‚îÄ */
  .arc-section {
    padding: 14px 18px 12px;
    border-bottom: 1px solid var(--border);
  }
  .arc-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 9px;
  }
  .arc-label { font-size: 11px; color: var(--text-mid); font-weight: 400; }
  .arc-pct   { font-size: 11px; color: var(--mint); font-weight: 600; }
  .arc-track {
    height: 10px; background: rgba(168,221,208,0.15);
    border-radius: 20px; overflow: visible; position: relative;
  }
  .arc-fill {
    height: 100%; width: 0%; border-radius: 20px;
    background: linear-gradient(90deg, #a8ddd0, #b8d8f0);
    box-shadow: 0 2px 10px rgba(168,221,208,0.5);
    position: relative; transition: width 0.8s ease;
  }
  .arc-orb {
    position: absolute; right: -8px; top: 50%; transform: translateY(-50%);
    width: 22px; height: 22px; border-radius: 50%;
    background: white; border: 2px solid #a8ddd0;
    box-shadow: 0 2px 10px rgba(168,221,208,0.7), 0 0 0 4px rgba(168,221,208,0.15);
    display: flex; align-items: center; justify-content: center; font-size: 10px;
    animation: orb-breathe 3s ease infinite;
  }
  @keyframes orb-breathe {
    0%,100% { box-shadow: 0 2px 10px rgba(168,221,208,.7), 0 0 0 4px rgba(168,221,208,.15); }
    50%      { box-shadow: 0 2px 16px rgba(168,221,208,.9), 0 0 0 8px rgba(168,221,208,.1); }
  }
  .time-marks {
    display: flex; justify-content: space-between; margin-top: 7px;
    font-size: 9px; color: var(--text-dim); font-weight: 300;
  }

  /* ‚îÄ‚îÄ NOW CARD ‚îÄ‚îÄ */
  .now-card {
    margin: 13px 16px 0;
    border-radius: 16px; background: white;
    border: 1px solid rgba(201,184,240,0.3);
    box-shadow: 0 4px 20px rgba(201,184,240,0.18), 0 1px 4px rgba(0,0,0,0.04);
    overflow: hidden;
  }
  .now-card.idle { opacity: 0.75; }
  .now-accent { height: 4px; background: linear-gradient(90deg, #c9b8f0, #f0b8c8, #f5c4a8); }
  .now-inner { padding: 13px 15px; }
  .now-eyebrow {
    display: flex; align-items: center; gap: 6px;
    font-size: 9px; color: var(--text-dim); font-weight: 500;
    letter-spacing: 1px; text-transform: uppercase; margin-bottom: 7px;
  }
  .live-dot {
    width: 6px; height: 6px; border-radius: 50%; background: #c9b8f0;
    box-shadow: 0 0 0 3px rgba(201,184,240,0.2); animation: soft-blink 2s ease infinite;
  }
  @keyframes soft-blink {
    0%,100% { opacity:1; box-shadow:0 0 0 3px rgba(201,184,240,.2); }
    50%      { opacity:.5; box-shadow:0 0 0 6px rgba(201,184,240,.1); }
  }
  .now-title {
    font-family: var(--font-serif);
    font-size: 21px; color: var(--text); margin-bottom: 2px;
  }
  .now-time-label { font-size: 11px; font-style: italic; font-weight: 300; color: var(--text-mid); margin-bottom: 13px; }
  .quest-track {
    height: 6px; background: var(--lavender-l);
    border-radius: 20px; overflow: visible; position: relative; margin-bottom: 7px;
  }
  .quest-fill {
    height: 100%; width: 0%; border-radius: 20px;
    background: linear-gradient(90deg, #c9b8f0, #d4a8f0);
    box-shadow: 0 1px 8px rgba(201,184,240,.5);
    position: relative; transition: width 0.6s ease;
  }
  .quest-orb {
    position: absolute; right: -4px; top: 50%; transform: translateY(-50%);
    width: 13px; height: 13px; border-radius: 50%;
    background: white; border: 2px solid #c9b8f0;
    box-shadow: 0 1px 6px rgba(201,184,240,.6);
  }
  .quest-footer {
    display: flex; justify-content: space-between;
    font-size: 10px; color: var(--text-dim);
  }
  .quest-footer span { color: var(--lavender); font-weight: 500; }

  /* ‚îÄ‚îÄ UP NEXT ‚îÄ‚îÄ */
  .next-card {
    margin: 10px 16px 0;
    border-radius: 12px; background: var(--peach-l);
    border: 1px solid rgba(245,196,168,0.4);
    padding: 11px 14px; display: flex; align-items: center; gap: 11px;
  }
  .next-icon {
    width: 32px; height: 32px; border-radius: 8px;
    background: rgba(245,196,168,0.55);
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; flex-shrink: 0;
  }
  .next-body { flex: 1; }
  .next-up-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #c47b5a; font-weight: 500; margin-bottom: 2px; }
  .next-name { font-size: 12px; font-weight: 500; color: var(--text); }
  .next-t    { font-size: 10px; color: var(--text-mid); font-style: italic; font-weight: 300; }
  .next-eta  { font-size: 11px; color: #c47b5a; font-weight: 600; background: rgba(245,196,168,.5); padding: 3px 8px; border-radius: 8px; white-space: nowrap; }

  /* ‚îÄ‚îÄ EXPAND ‚îÄ‚îÄ */
  .expand-toggle {
    margin: 12px 16px 0;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    cursor: pointer; padding: 8px; border-radius: 10px;
    border: 1px dashed rgba(180,160,220,0.25); color: var(--text-dim);
    font-size: 10px; font-weight: 400; letter-spacing: 0.3px;
    transition: all 0.2s; user-select: none;
  }
  .expand-toggle:hover { background: white; border-color: rgba(201,184,240,.4); color: var(--text-mid); }
  .expand-arrow { font-size: 9px; transition: transform 0.3s cubic-bezier(.22,1,.36,1); }
  .expand-arrow.open { transform: rotate(180deg); }

  /* ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ */
  .task-drawer {
    overflow: hidden; max-height: 0;
    transition: max-height 0.4s cubic-bezier(.22,1,.36,1), opacity 0.3s ease;
    opacity: 0;
  }
  .task-drawer.open { max-height: 300px; opacity: 1; }
  .task-drawer-inner { padding: 10px 16px 0; }
  .drawer-label { font-size: 9px; letter-spacing: 1px; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px; padding: 0 2px; }
  .drawer-empty { font-size: 12px; color: var(--text-dim); text-align: center; padding: 16px 0; font-style: italic; }

  .task-row {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 10px; border-radius: 10px; margin-bottom: 4px;
    border: 1px solid transparent; cursor: pointer; transition: all 0.2s;
  }
  .task-row:hover { background: white; border-color: var(--border); }
  .task-row.done-row { opacity: 0.4; }
  .task-row.done-row .t-name { text-decoration: line-through; text-decoration-color: var(--mint); }

  .t-check {
    width: 17px; height: 17px; border-radius: 5px; border: 1.5px solid;
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; flex-shrink: 0; transition: all 0.3s;
  }
  .t-check.empty   { border-color: rgba(180,160,220,0.25); }
  .t-check.checked { border-color: var(--mint); background: var(--mint-l); color: #5aaa96; }
  .t-check.current {
    border-color: var(--lavender); background: var(--lavender-l);
    animation: check-breathe 2s ease infinite;
  }
  @keyframes check-breathe {
    0%,100% { box-shadow:0 0 0 0 rgba(201,184,240,.3); }
    50%      { box-shadow:0 0 0 4px rgba(201,184,240,.15); }
  }
  .t-info { flex: 1; }
  .t-name { font-size: 11px; color: var(--text); margin-bottom: 1px; }
  .t-time { font-size: 10px; color: var(--text-dim); font-style: italic; font-weight: 300; }
  .t-tag  { font-size: 9px; color: var(--text-dim); font-style: italic; }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  .footer {
    border-top: 1px solid var(--border); margin-top: 13px;
    padding: 11px 18px; display: flex; align-items: center; justify-content: space-between;
    background: rgba(255,255,255,0.5);
  }
  .footer-left { font-size: 10px; color: var(--text-dim); font-style: italic; font-weight: 300; }

  .btn-complete {
    background: white; border: 1.5px solid rgba(201,184,240,0.5);
    color: #8b6fcc; font-family: var(--font-sans);
    font-size: 11px; font-weight: 500; padding: 8px 16px; border-radius: 10px;
    cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 10px rgba(201,184,240,.18);
  }
  .btn-complete:hover { background: var(--lavender-l); border-color: var(--lavender); box-shadow: 0 4px 18px rgba(201,184,240,.35); transform: translateY(-1px); }
  .btn-complete:active  { transform: scale(.97); }
  .btn-complete:disabled { opacity: .35; cursor: default; transform: none; }

  /* ‚îÄ‚îÄ FX ‚îÄ‚îÄ */
  .fx-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 50; }
  .fx-flash {
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 40%, rgba(201,184,240,.28), transparent 70%);
    opacity: 0;
  }
  .fx-flash.pop { animation: flashPop .5s ease forwards; }
  @keyframes flashPop { 0%{opacity:0;} 25%{opacity:1;} 100%{opacity:0;} }

  .xp-float {
    position: absolute; top: 40%; left: 50%; transform: translate(-50%,-50%);
    font-family: var(--font-serif); font-size: 20px;
    background: linear-gradient(135deg, #c9b8f0, #f0b8c8);
    -webkit-background-clip: text; background-clip: text; color: transparent;
    filter: drop-shadow(0 3px 10px rgba(201,184,240,.7));
    white-space: nowrap; opacity: 0;
  }
  .xp-float.pop { animation: floatUp .85s cubic-bezier(.22,1,.36,1) forwards; }
  @keyframes floatUp {
    0%  { opacity:0; transform:translate(-50%,-20%); }
    25% { opacity:1; transform:translate(-50%,-45%) scale(1.05); }
    70% { opacity:1; transform:translate(-50%,-65%); }
    100%{ opacity:0; transform:translate(-50%,-80%) scale(.95); }
  }
</style>
</head>
<body>

<div class="bg-mesh"></div>

<div class="fx-overlay">
  <div class="fx-flash" id="flash"></div>
  <div class="xp-float" id="xpFloat">done ‚ú¶</div>
</div>

<div class="popup">

  <!-- LOADING -->
  <div id="loadingState" style="display:flex">
    <div class="loading-orb"></div>
    <div class="loading-text">Loading your day‚Ä¶</div>
  </div>

  <!-- ERROR -->
  <div id="errorState">
    <div class="error-icon">üå∏</div>
    <div id="errorMsg">Connect your Google Calendar to get started.</div>
    <button id="signInBtn">Connect Calendar</button>
  </div>

  <!-- MAIN -->
  <div id="mainContent" style="display:none">

    <div class="header">
      <div class="header-top">
        <div class="wordmark">Day<em>flow</em></div>
        <div class="streak-pill" id="streakPill">üå∏ day 1</div>
      </div>
      <div class="header-meta">
        <div class="date-label" id="dateLabel"></div>
      </div>
    </div>

    <div class="arc-section">
      <div class="arc-row">
        <div class="arc-label">Today's journey</div>
        <div class="arc-pct" id="dayPct">0%</div>
      </div>
      <div class="arc-track">
        <div class="arc-fill" id="arcFill">
          <div class="arc-orb">‚òÄÔ∏è</div>
        </div>
      </div>
      <div class="time-marks">
        <span>12 am</span><span>6 am</span><span>12 pm</span><span>6 pm</span><span>12 am</span>
      </div>
    </div>

    <div class="now-card" id="nowCard">
      <div class="now-accent"></div>
      <div class="now-inner">
        <div class="now-eyebrow"><div class="live-dot"></div>now</div>
        <div class="now-title" id="nowTitle">‚Äî</div>
        <div class="now-time-label" id="nowTime"></div>
        <div class="quest-track">
          <div class="quest-fill" id="questFill"><div class="quest-orb"></div></div>
        </div>
        <div class="quest-footer">
          <span>in progress</span>
          <span id="minLeft"></span>
        </div>
      </div>
    </div>

    <div class="next-card" id="nextCard">
      <div class="next-icon" id="nextIcon">‚ú¶</div>
      <div class="next-body">
        <div class="next-up-label">up next</div>
        <div class="next-name" id="nextName"></div>
        <div class="next-t" id="nextTime"></div>
      </div>
      <div class="next-eta" id="nextEta"></div>
    </div>

    <div class="expand-toggle" id="expandBtn">
      <span id="expandLabel">see all tasks</span>
      <span class="expand-arrow" id="expandArrow">‚ñæ</span>
    </div>

    <div class="task-drawer" id="taskDrawer">
      <div class="task-drawer-inner">
        <div class="drawer-label">today's schedule</div>
        <div id="drawerList"></div>
      </div>
    </div>

    <div class="footer">
      <div class="footer-left" id="footerMsg">have a great day ‚ú¶</div>
      <button class="btn-complete" id="completeBtn">Mark complete</button>
    </div>

  </div>
</div>

<script src="popup.js"></script>
</body>
</html>